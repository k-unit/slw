From 958d7b0fa0bdf3adf679d563ad7d96d3378ef98a Mon Sep 17 00:00:00 2001
From: Ilan Smith <ilan.smith@sandisk.com>
Date: Sun, 7 Jun 2015 22:29:38 +0300
Subject: [PATCH] lib: Added sliding window.

---
 include/linux/sliding_window.h | 33 +++++++++++++++++++++++++++++++++
 lib/Kconfig                    |  6 ++++++
 lib/Makefile                   |  2 ++
 3 files changed, 41 insertions(+)
 create mode 100644 include/linux/sliding_window.h

diff --git a/include/linux/sliding_window.h b/include/linux/sliding_window.h
new file mode 100644
index 0000000..caa5cfe
--- /dev/null
+++ b/include/linux/sliding_window.h
@@ -0,0 +1,33 @@
+#ifndef _SLIDING_WINDOW_H_
+#define _SLIDING_WINDOW_H_
+
+#include <linux/spinlock.h>
+#include <linux/types.h>
+
+enum slw_val {
+	SLW_NONE = 0,
+	SLW_READ,
+	SLW_WRITE
+};
+
+struct sliding_window {
+	u32 *__window;		/* initialized to some given size */
+	u32 __size;		/* size of the sliding window in words */
+	u32 *__major;		/* pointer into window */
+	u32 __offset;		/* offset of the 0x3 mask in __major */
+	spinlock_t __lock;	/* statistic read/write lock */
+	u32 width;		/* sliding window width */
+	u32 stat[2];		/* statistic table */
+};
+
+int slw_init(struct sliding_window *slw, u32 width);
+void slw_uninit(struct sliding_window *slw);
+int slw_resize(struct sliding_window *slw, u32 width);
+
+bool slw_advance(struct sliding_window *slw, enum slw_val val_new);
+void slw_reset(struct sliding_window *slw);
+
+u32 slw_width_get(struct sliding_window *slw);
+u32 slw_val_get(struct sliding_window *slw, enum slw_val val);
+#endif
+
diff --git a/lib/Kconfig b/lib/Kconfig
index d9c307d..5fefe82 100644
--- a/lib/Kconfig
+++ b/lib/Kconfig
@@ -423,4 +423,10 @@ config QMI_ENCDEC_DEBUG
 	  library. This will log the information regarding the element
 	  and message being encoded & decoded.
 
+config LIB_SLW
+	tristate "Generic Sliding Window"
+	default y
+	help
+	  Kernel config option to include the generic sliding window library
+	  function.
 endmenu
diff --git a/lib/Makefile b/lib/Makefile
index 86572b4..4a0fd6c 100644
--- a/lib/Makefile
+++ b/lib/Makefile
@@ -182,3 +182,5 @@ quiet_cmd_build_OID_registry = GEN     $@
 clean-files	+= oid_registry_data.c
 
 obj-$(CONFIG_UCS2_STRING) += ucs2_string.o
+
+obj-$(CONFIG_LIB_SLW) += $(LIB_SLW_PATH)/sliding_window.o
-- 
1.9.1

